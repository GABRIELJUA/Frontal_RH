<!-- ================= TOAST ================= -->

<div *ngIf="toast.show" class="fixed bottom-5 right-5 z-[999] min-w-[260px] max-w-sm">

  <div class="px-4 py-3 rounded-lg shadow-lg text-sm font-semibold text-white
              flex items-center gap-2 animate-fade-in" [ngClass]="{
        'bg-emerald-500': toast.type === 'success',
        'bg-red-500': toast.type === 'error',
        'bg-amber-500': toast.type === 'warning',
        'bg-slate-800': toast.type === 'info'
       }">

    <span *ngIf="toast.type==='success'">✔</span>
    <span *ngIf="toast.type==='error'">✖</span>
    <span *ngIf="toast.type==='warning'">⚠</span>
    <span *ngIf="toast.type==='info'">ℹ</span>

    {{ toast.message }}

  </div>
</div>

<div class="space-y-6">

  <!-- ================= HEADER ================= -->

  <div class="flex items-center justify-between">
    <div>
      <h2 class="text-xl font-semibold text-slate-800 dark:text-white">
        Biblioteca Digital
      </h2>
      <p class="text-xs text-slate-400 mt-1">
        Manuales, reglamentos y documentos internos de la empresa
      </p>
    </div>

    <button (click)="abrirModalSubir()" *ngIf="canUpload" class="inline-flex items-center gap-2 px-4 py-2 text-xs font-semibold
         bg-orange-500 text-white rounded-md hover:bg-orange-600 transition">
      + Subir documento
    </button>

  </div>

  <!-- ================= BUSCADOR ================= -->

  <div class="flex flex-col md:flex-row gap-3">

    <input [(ngModel)]="busqueda" (input)="filtrar()" placeholder="Buscar documento..." class="w-full md:w-80 px-3 py-2 border border-slate-200 dark:border-slate-700
         rounded-md text-sm bg-white dark:bg-slate-900
         text-slate-800 dark:text-slate-200
         focus:outline-none focus:ring-2 focus:ring-orange-500/20">

    <select [(ngModel)]="categoriaFiltro" (change)="filtrar()" class="w-full md:w-56 px-3 py-2 border border-slate-200 dark:border-slate-700
         rounded-md text-sm bg-white dark:bg-slate-900
         text-slate-800 dark:text-slate-200
         focus:outline-none focus:ring-2 focus:ring-orange-500/20">

      <option value="">Todas las categorías</option>
      <option value="Manual">Manual</option>
      <option value="Reglamento">Reglamento</option>
      <option value="Formato">Formato</option>
    </select>

  </div>

  <!-- ================= CONTENEDOR ================= -->

  <div class="bg-white dark:bg-[#020617]
              border border-slate-200 dark:border-slate-800
              rounded-xl overflow-hidden">

    <!-- LOADING -->
    <div *ngIf="loading" class="p-10 text-center text-slate-400 text-sm">
      Cargando documentos…
    </div>

    <!-- VACIO -->
    <div *ngIf="!loading && !documentosFiltrados.length" class="p-10 text-center text-slate-400 text-sm">
      No hay documentos registrados
    </div>

    <!-- GRID -->
    <div *ngIf="!loading && documentosFiltrados.length"
      class="grid sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-5 p-6">

      <div *ngFor="let d of documentosFiltrados" class="bg-white dark:bg-slate-950
              border border-slate-200 dark:border-slate-800
              rounded-xl p-4 hover:shadow-md transition">

        <!-- ===== PREVIEW ARCHIVO ===== -->
        <div class="mb-4">

          <!-- IMAGEN PREVIEW -->
          <img *ngIf="getTipoArchivo(d.archivo_url)==='image'" [src]="getFileUrl(d.archivo_url)" class="w-full h-36 object-cover rounded-lg border
              border-slate-200 dark:border-slate-700">

          <!-- PDF PREVIEW -->
          <div *ngIf="getTipoArchivo(d.archivo_url)==='pdf'" class="rounded-lg overflow-hidden border
              border-slate-200 dark:border-slate-700 bg-white">

            <iframe [src]="getSafePdfUrl(d.archivo_url)" class="w-full h-40">
            </iframe>

          </div>

          <!-- WORD / EXCEL / OTROS -->
          <div *ngIf="getTipoArchivo(d.archivo_url)==='file'" class="flex items-center justify-center py-6">

            <div class="w-14 h-14 rounded-xl
                            bg-white dark:bg-slate-800
                            border border-slate-200 dark:border-slate-700
                            flex items-center justify-center shadow-sm">

              <img [src]="getIconoArchivo(d.archivo_url)" class="w-8 h-8 object-contain">

            </div>

          </div>

        </div>

        <!-- TITULO -->
        <div class="font-medium text-slate-800 dark:text-white text-sm leading-tight">
          {{ d.titulo }}
        </div>

        <!-- ARCHIVO -->
        <div class="text-[11px] text-slate-400 mt-1 truncate">
          {{ d.archivo_url?.split('/').pop() }}
        </div>

        <!-- CATEGORIA -->
        <div class="mt-3">
          <span class="inline-flex items-center px-2.5 py-1 rounded-full
                   text-[11px] font-semibold
                   bg-slate-100 text-slate-600
                   dark:bg-slate-800 dark:text-slate-300">
            {{ d.categoria || 'General' }}
          </span>
        </div>

        <!-- FECHA -->
        <div class="text-[10px] text-slate-400 mt-2 font-mono">
          {{ d.fecha_subida | date:'yyyy-MM-dd' }}
        </div>

        <!-- ACCIONES -->
        <div class="flex justify-between items-center mt-4 pt-3
                border-t border-slate-100 dark:border-slate-800">

          <a [href]="getFileUrl(d.archivo_url)" target="_blank" class="text-xs font-semibold text-blue-600 hover:text-blue-800
               dark:text-orange-400 dark:hover:text-orange-300 transition">
            Abrir
          </a>

          <button *ngIf="canDelete" (click)="eliminar(d.id)"
            class="text-xs font-semibold text-red-500 hover:text-red-700 transition">
            Eliminar
          </button>

        </div>
      </div>

    </div>

  </div>
</div>

<!-- ================= MODAL SUBIR ================= -->

<div *ngIf="mostrarSubir" class="fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm">

  <div class="bg-white dark:bg-[#020617]
              border border-slate-200 dark:border-slate-800
              w-full max-w-md rounded-xl shadow-xl overflow-hidden">

    <!-- HEADER -->
    <div class="px-6 py-4 border-b border-slate-200 dark:border-slate-800 flex justify-between items-center">
      <h3 class="text-sm font-semibold text-slate-800 dark:text-white">
        Subir documento
      </h3>

      <button (click)="mostrarSubir = false" class="text-slate-400 hover:text-slate-600 dark:hover:text-white">
        ✕
      </button>
    </div>

    <!-- FORM -->
    <form (submit)="subir(); $event.preventDefault()" class="p-6 space-y-4">

      <div>
        <label class="block text-xs font-semibold text-slate-500 mb-1">
          Título *
        </label>
        <input [(ngModel)]="form.titulo" name="titulo" required type="text" class="w-full px-3 py-2 border border-slate-200 dark:border-slate-700
             rounded-md text-sm bg-white dark:bg-slate-900
             text-slate-800 dark:text-slate-200">
      </div>

      <div>
        <label class="block text-xs font-semibold text-slate-500 mb-1">
          Categoría
        </label>
        <select [(ngModel)]="form.categoria" name="categoria" class="w-full px-3 py-2 border border-slate-200 dark:border-slate-700
             rounded-md text-sm bg-white dark:bg-slate-900
             text-slate-800 dark:text-slate-200">
          <option value="">General</option>
          <option value="Manual">Manual</option>
          <option value="Reglamento">Reglamento</option>
          <option value="Formato">Formato</option>
        </select>
      </div>

      <div>
        <label class="block text-xs font-semibold text-slate-500 mb-1">
          Descripción
        </label>
        <textarea [(ngModel)]="form.descripcion" name="descripcion" rows="2" class="w-full px-3 py-2 border border-slate-200 dark:border-slate-700
             rounded-md text-sm bg-white dark:bg-slate-900
             text-slate-800 dark:text-slate-200"></textarea>
      </div>

      <div>
        <label class="block text-xs font-semibold text-slate-500 mb-1">
          Archivo *
        </label>
        <input type="file" (change)="onFileChange($event)" class="w-full text-sm text-slate-700 dark:text-slate-300">
      </div>

      <div class="flex justify-end gap-3 pt-4">
        <button type="button" (click)="mostrarSubir = false"
          class="px-4 py-2 text-xs font-semibold text-slate-500 hover:text-slate-700 dark:hover:text-white">
          Cancelar
        </button>

        <button type="submit" class="px-4 py-2 text-xs font-semibold text-white
             bg-orange-500 hover:bg-orange-600 rounded-md transition">
          Subir documento
        </button>
      </div>

    </form>

  </div>
</div>

<!-- ================= MODAL CONFIRM DELETE ================= -->

<div *ngIf="mostrarConfirmDelete"
  class="fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm">

  <div class="bg-white dark:bg-[#020617]
              border border-slate-200 dark:border-slate-800
              w-full max-w-sm rounded-xl shadow-xl p-6 space-y-4">

    <div class="text-sm font-semibold text-slate-800 dark:text-white">
      ¿Eliminar documento?
    </div>

    <p class="text-xs text-slate-500">
      Esta acción no se puede deshacer.
    </p>

    <div class="flex justify-end gap-3 pt-4">

      <button (click)="cancelarEliminar()"
        class="px-4 py-2 text-xs font-semibold text-slate-500 hover:text-slate-700 dark:hover:text-white">
        Cancelar
      </button>

      <button (click)="confirmarEliminar()"
        class="px-4 py-2 text-xs font-semibold text-white bg-red-500 hover:bg-red-600 rounded-md">
        Sí, eliminar
      </button>

    </div>

  </div>
</div>